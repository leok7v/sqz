# Squeeze Single Header Library

Generated by scripts/amalgamate.bat or amalgamate.sh from sqz.h and sqz.c

### Single header library include:

```
#define sqz_implementation   // include the implementation after definition.
#include "shl/sqz/sqz.h" // assuming -I path is present

int main(int argc, const char* argv[]) {
    return 0;
}
```

### Squeeze compression simple use case:

```
#define sqz_implementation
#include "shl/sqz/sqz.h"
#include <stdio.h>

int main(int argc, const char* argv[]) {
    (void)argc; (void)argv;
    const char* text = "Lorem ipsum dolor sit amet. "
                       "Lorem ipsum dolor sit amet. "
                       "Lorem ipsum dolor sit amet. ";
    static uint8_t compressed[1024]; // 1KB
    uint64_t compressed_size = 0;
    {
        struct bitstream write = { .data = compressed,
                                   .capacity = sizeof(compressed) };
        size_t input_size = strlen(text);
        sqz_write_header(&write, input_size);
        static struct sqz compress;
        sqz_init(&compress);
        sqz_compress(&compress, &write, (const uint8_t*)text,
                         input_size, 1u << 11); // 2KB window_bits: 11
        if (compress.error != 0) {
            printf("Compression error: %d\n", compress.error);
            return compress.error;
        }
        compressed_size = write.bytes;
        printf("%d into %d bytes\n", (int)input_size, (int)compressed_size);
    }
    {
        struct bitstream read = { .data = compressed,
                                  .capacity = compressed_size };
        uint64_t decompressed = 0;
        sqz_read_header(&read, &decompressed);
        static char decompressed_data[1024];
        static struct sqz decompress;
        sqz_init(&decompress);
        if (decompressed != strlen(text)) {
            printf("Decompressed size does not match original size\n");
            return EINVAL;
        }
        sqz_decompress(&decompress, &read, (uint8_t*)decompressed_data,
                                                decompressed);
        if (decompress.error != 0) {
            printf("Decompression error: %d\n", decompress.error);
            return decompress.error;
        }
        if (memcmp(decompressed_data, text, decompressed) != 0) {
            printf("Decompressed data does not match original data\n");
            return EINVAL;
        }
        printf("Decompression successful.\n");
    }
    return 0;
}

```

### Confine all exposed static implementation functions to single file:

file ``main.c``

```
#include "shl/sqz/sqz.h" // only header file declarations

int test_compression(void) { /*...*/ }

int main(int argc, const char* argv[]) {
    return test_compression();
}
```

file ``sqz_shl.c``

```
#define sqz_implementation
#include "shl/sqz/sqz.h"
```
